# vk-task

Этот репозиторий содержит реализацию тестового задания для стажировки ВКонтакте.

Посмотреть на результат можно [здесь](https://danyadev.github.io/vk-task/).

## Поле для ввода текста

Я добавил максимальную высоту, но при этом убрал скроллбар внутри:
- добавить кастомный скроллбар в данном случае проблематично
- дефолтный скроллбар на винде (где я и сижу) выглядит ужасно

Кнопка для открытия окошка с эмодзи разделяет поле на текст и вертикальную полоску с кнопкой.
Возможно и существует возможность расположить кнопку так, чтобы текст мог быть и под кнопкой
(как показано в фигме), но это наверняка был бы костыль, да и такого функционала я нигде не видел:
в вебе, в мессенджере, в мобильном приложении - везде реализация такая же, как и у меня.

## Окошко с эмодзи

Стрелка, указывающая на кнопку открытия окошка, получилась довольно острой (прямо как в vk.com),
но мне кажется нет особого смысла вырезать из фигмы кусочек с гладкой стрелкой и вставлять
в верстку, особенно когда я почти не умею работать с фигмой в плане дизайнера.

Или существуют другие простые способы сделать гладкую стрелку?

## Кастомный скроллбар

Да, здесь есть даже он. И не какой-то левый модуль, а самописный компонент, который я
реализовал для своего [клиента](https://github.com/danyadev/vk-desktop)!

Здесь использовал немного обрезанную версию: выкинул лишний код и немного поменял стили,
чтобы соответствовать макету и поведению в vk.com.

## Оптимизация рендера эмодзей

Здесь я применил такой же метод, как и в vk.com:
сначала отображается только одна секция, а по мере прокрутки происходит
добавление двух новых.

Однако можно было поступить и по другому. Почему?
* во время прокрутки скроллбар скачет
* Добавление новой секции - весьма затратная операция, которая требует
приличного количества времени

Можно воспользоваться виртуальным скроллингом для исправления всех этих проблем
и возможно небольшой оптимизации скорости скролла.

Только вот игрался я с виртуальным скроллингом совсем немного и еще не успел
реализовать свое решение. Поэтому здесь этой оптимизации не будет.

## Использование спрайтов для отображения эмодзи

Существует несколько способов реализовать отображение эмодзей по спрайтам.

Я выбрал второй вариант, потому что при попытке реализации первого у меня поломался
один из css-лоадеров.

### Способ первый

Он используется в vk.com: добавляем в класс тега `i` hex-код эмодзи и устанавливаем
в стилях все расположения эмодзей в спрайтах.

Данный способ работает неплохо, но вот только css кода при этом оказывается довольно
много - больше 300кб.

### Способ второй

Этот способ используется уже в моем мессенджере: мы генерируем .json файл с
эмодзями и их расположениями в спрайтах. Таким образом можно сократить объем хранимых
данных до менее 100кб. Мне же удалось уместить все
[данные](https://github.com/danyadev/vk-desktop/blob/master/src/js/json/localEmoji.json)
в 61кб, используя небольшой костыль для сжатия.

### Способ третий

Мы можем хранить просто список эмодзей без позиций, ведь мы можем их посчитать самостоятельно!

Все спрайты (кроме последнего) имеют одинаковую высоту и ширину, а последний спрайт на данный
момент содержит 4 эмодзи, которые можно разместить в одной строке.

Зная количество строк и столбцов, мы можем по позиции эмодзи в списке посчитать
номер спрайта, его строку и столбец, и затем уже вычислить координаты в пикселях.

Этот вариант можно считать как доработку второго, ибо мы так же создаем отдельный файл
с эмодзями и гонимся за минимизированием хранимых данных.

Но возможно в плане производительности это будет работать не так хорошо,
ведь нам нужно каждый раз искать эмодзи в гигантском списке и делать небольшие расчеты
либо один раз посчитать абсолютно все координаты и хранить в памяти жирный объект (или мапу).

## Поддержка Safari

На Safari появился баг при попытке добавить эмодзи в текстовое поле:
1) юзер нажимает на эмодзи в панели и сафари меняет selection на него
2) автоматически происходит фокус инпута, но последняя позиция каретки уже потеряна,
поэтому каретка вставляется в самое начало
3) сама эмодзя вставляется уже в начало текстового поля

Из-за отсутствия доступа к самому браузеру я не имею возможности исправить этот баг,
поэтому оставлю все как есть.

Я потратил на попытку исправить этот баг не менее 5 часов...

## Подсветка различных частей текста в инпуте

Для рендера различных блоков (текст, эмодзи, хештег, ...) в сообщении,
где нет contenteditable и соответственно можно подставлять верстку прямо
внутрь тега, я бы написал отдельный компонент Vue с рендер-функцией внутри.

Для такого же функционала в текстовом поле рендер-функции Vue не подойдут -
там ведь все гораздо сложнее чем генерация HTMLElement'ов.
Поэтому мне пришлось вручную создавать html-элементы и заменять ими контент
в текстовом поле.
